name: AI CI Failure Demo

on:
  push:
  workflow_dispatch:

jobs:
  fail-demo:
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      pull-requests: write
    steps:
      - name: Step 1 - always succeeds
        run: echo "Hello from the first step"

      - name: Step 2 - broken docker build (fails intentionally)
        run: docker build -t invalid-image ./does-not-exist

      - name: Step 3 - AI failure helper
        if: always()
        uses: maxlim0/actions-progci-fail@v0.7
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          openrouter_api_key: ${{ secrets.OPENROUTER_API_KEY }}
          model: x-ai/grok-4.1-fast:free
          prompt_template: |
            Workflow {{WORKFLOW_NAME}} failed at job {{JOB_NAME}}, step {{STEP_NAME}}.
            Last log lines:
            {{LOG}}

            Explain the likely root cause and suggest concrete fixes.
          max_log_lines: 200
